{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/articles/list.css' %}">

<!-- Articles Grid -->
<div class="newspaper-articles-grid">
  {% for article in articles %}
  <article class="newspaper-article-card">
    <a href="{% url 'articles:article-detail' article.pk %}" class="read-more">
      <h2 class="newspaper-article-title">{{ article.title|safe }}</h2>
      <p class="article-excerpt">
        {{ article.content|safe|striptags|truncatewords:200 }}
      </p>
    </a>
  </article>
  {% endfor %}
</div>

<!-- Pagination -->
{% if is_paginated %}
<nav class="figma-pagination">
  <div class="pagination-container">
    <!-- Previous Button -->
    <a href="?page={% if page_obj.has_previous %}{{ page_obj.previous_page_number }}{% else %}{{ page_obj.number }}{% endif %}"
      class="pagination-arrow prev" title="Previous Page" {% if not page_obj.has_previous %}disabled{% endif %}>
      ◀
    </a>

    <!-- Page Numbers -->
    <div class="pagination-numbers">
      {% for num in page_obj.paginator.page_range %}
      {% if num == page_obj.number %}
      <span class="page-number active">{{ num }}</span>
      {% elif num <= 3 or num>= page_obj.paginator.num_pages|add:"-2" or num == page_obj.number|add:"-1" or num ==
        page_obj.number|add:"1" %}
        <a href="?page={{ num }}" class="page-number">{{ num }}</a>
        {% elif num == 4 and page_obj.number > 5 %}
        <span class="page-ellipsis">...</span>
        {% elif num == page_obj.paginator.num_pages|add:"-3" and page_obj.number < page_obj.paginator.num_pages|add:"-4"
          %} <span class="page-ellipsis">...</span>
          {% endif %}
          {% endfor %}
    </div>

    <!-- Next Button -->
    <a href="?page={% if page_obj.has_next %}{{ page_obj.next_page_number }}{% else %}{{ page_obj.number }}{% endif %}"
      class="pagination-arrow next" title="Next Page" {% if not page_obj.has_next %}disabled{% endif %}>
      ▶
    </a>
  </div>
</nav>
{% endif %}

<!-- Filter Form -->
<form method="get" class="newspaper-filter-form">
  <div class="filter-grid">
    <!-- Search -->
    <div class="filter-group">
      <label for="search-input" class="filter-label">Search Articles</label>
      <textarea name="search" class="filter-input" id="search-input" placeholder="Search titles or content..."
        rows="4">{{ current_filters.search }}</textarea>
    </div>

    <!-- Language -->
    <div class="filter-group">
      <label for="language-select" class="filter-label">Filter by Language</label>
      <select name="language" id="language-select" class="filter-select" multiple>
        {% for code, name in LanguageChoices %}
        <option value="{{ code }}" {% if code in current_filters.languages %}selected{% endif %}>
          {{ name }}
        </option>
        {% endfor %}
      </select>
      <span class="filter-hint">(Hold Ctrl/Cmd to select multiple)</span>
    </div>

    <!-- Topic -->
    <div class="filter-group">
      <label for="topic-select" class="filter-label">Filter by Topic</label>
      <select name="topic" id="topic-select" class="filter-select" multiple>
        {% for code, name in TopicChoices %}
        <option value="{{ code }}" {% if code in current_filters.topics %}selected{% endif %}>
          {{ name }}
        </option>
        {% endfor %}
      </select>
      <span class="filter-hint">(Hold Ctrl/Cmd to select multiple)</span>
    </div>

    <!-- Date Range -->
    <div class="filter-group date-range">
      <label class="filter-label">Date Range</label>
      <div class="date-inputs">
        <label for="date-from" class="date-label">From</label>
        <input type="date" name="date_from" id="date-from" class="filter-date" value="{{ current_filters.date_from }}">
        <label for="date-to" class="date-label">To</label>
        <input type="date" name="date_to" id="date-to" class="filter-date" value="{{ current_filters.date_to }}">
      </div>
    </div>

    <!-- Sort -->
    <div class="filter-group">
      <label for="sort-select" class="filter-label">Sort By</label>
      <select name="sort" id="sort-select" class="filter-select">
        <option value="-created_at" {% if current_filters.sort=='-created_at' %}selected{% endif %}>
          Newest First
        </option>
        <option value="created_at" {% if current_filters.sort=='created_at' %}selected{% endif %}>
          Oldest First
        </option>
      </select>
    </div>

    <!-- Buttons -->
    <div class="filter-buttons">
      <button type="submit" class="filter-button apply">Search</button>
      <a href="{% url 'articles:article-list' %}" class="filter-button reset">Reset</a>
    </div>
  </div>
</form>

<script src="{% static 'js/articles/list.js' %}"></script>
{% endblock %}